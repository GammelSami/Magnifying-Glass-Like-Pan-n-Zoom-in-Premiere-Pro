<!DOCTYPE html>
<!-- This document forms the dockable panel. -->
<html>
	<head>
		<meta charset="utf-8">
		<title>Motion Control Panel</title>
		<link rel="stylesheet" href="css/style.css">
		<script src="./lib/CSInterface.js"></script>
    <!-- USE konva DEVELOPMENT VERSION --><script src="lib/konva.min.js"></script>
		<script src="js/functions.js"></script>
		<script>
			const DEBUG = true;
			var cs = new CSInterface();
		</script>
	</head>
	<body>
		<details open>
			<summary>Debug Area</summary>
			<fieldset>
				<legend>Setter/Getter Demo</legend>
				sequenceWidth: 	<input type="number" id="sequenceWidth"><br>
				sequenceHeight: <input type="number" id="sequenceHeight"><br>
				clipPositionX: 	<input type="number" id="clipPositionX"><br>
				clipPositionY: 	<input type="number" id="clipPositionY"><br>
				clipScale:			<input type="number" id="clipScale"><br>
				clipScaleW:			<input type="number" id="clipScaleW"><br>
				clipScaleSync:	<input type="checkbox" id="clipScaleSync"><br>
				clipRotation:			<input type="number" id="clipRotation"><br>
				clipAnchorPointX:		<input type="number" id="clipAnchorPointX"><br>
				clipAnchorPointY:		<input type="number" id="clipAnchorPointY"><br>

				clipWidth: 		<input type="number" id="clipWidth" disabled><br>
				clipHeight:	 	<input type="number" id="clipHeight" disabled><br>
				<button onclick="applySequenceValues();">Apply</button><br>
			</fieldset>
			<textarea id="debugLog" style="width:99%;height:100px;"></textarea>
		</details>
		<div id="stage">Something went wrong. Try to reload the Panel or press F5 for soft reload.</div>
	</body>
</html>



<script>//refresh on F5
window.addEventListener('keydown', (e) => {
	if (e.code == 'F5') location.reload(); //this only reloads the html, not the jsx
})
</script>



<script>//konva stuff

/********** init conva objects **********/

var stage = new Konva.Stage({
	container: 'stage',
	width: null,
	height: null
});

var layer = new Konva.Layer();
stage.add(layer);

var spotlight = new Konva.Rect({
	draggable: true,
	x: null, //position x
	y: null, //position y
	offsetX: null, //position offset (not rotation anchorpoint)
	offsetY: null,
	width: null, //sequence width
	height: null, //sequence height
	name: 'spotlight',
});
layer.add(spotlight);

fetchSequenceValues();

var tr = new Konva.Transformer({
	keepRatio: true,
	rotationSnaps: [0, 45, 90, 135, 180, 225, 270, 315]
});
layer.add(tr);
tr.attachTo(spotlight);
layer.draw();

//debugtext
if (DEBUG) {
	var text = new Konva.Text({
		x: 5,
		y: 5,
		fill: '#B9B9B9' //textcolor from css
	});
	layer.add(text);
	updateText();
}

</script>



<script src="js/events.js">//add event listeners</script>
